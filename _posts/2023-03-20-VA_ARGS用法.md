---
title: C++ —— VA_ARGS用法
authors: fanventory
date: 2023-03-20 20:30:00 +0800
categories: [other, C++]
tags: [C++, precompile]
---

# __VA_ARGS__
> 在C++实现日志打印时，常常会用到__VA_ARGS__或##__VA_ARGS__符号，它的作用是在宏中将可变参数的内容替换掉__VA_ARGS__的内容

<br>
<br>

## 作用
__VA_ARGS__在宏中将函数的可变参数进行替换，##__VA_ARGS_则在__VA_ARGS__基础上，使可变参数为零时，去掉参数前面的逗号。

## __VA_ARGS__
__VA_ARGS__的用法例子如下：  
```c++
#include <stdio.h>

#define Log(fm, ...) printf(fm, __VA_ARGS__) // ...表示可变参数，__VA_ARGS__就是将...的值复制到这里

int main()
{
    // 输出可变参数
    Log("tow argument: %s %d\n", "hello world!", 2023); //OK
    // Log("no argument");    // error
    return 0;
}
```

输出如下：
```
tow argument: hello world! 2023
```

当我们调用Log("no argument");时，却报错了：  
```
VA_ARGS.cpp: In function ‘int main()’:
VA_ARGS.cpp:3:43: error: expected primary-expression before ‘)’ token
 #define Log(fm, ...) printf(fm,__VA_ARGS__) 
                                           ^
VA_ARGS.cpp:9:5: note: in expansion of macro ‘Log’
     Log("987654321");    //输出字符串常量报错
```

这里报错的原因是因为字符串no argument赋给了fm，__VA_ARGS__的值为空，宏替换后函数变为printf("no argument",)，末尾的这个逗号很明显是语法错误的。为了解决这个问题，我们可以使用##__VA_ARGS__宏。

## ##__VA_ARGS__
```c++
#include <stdio.h>

#define Log(fm, ...) printf(fm,##__VA_ARGS__) // ##__VA_ARGS__可以去掉前面的逗号

int main()
{
    //输出可变参数
    Log("tow argument: %s %d\n", "hello world!", 2023); // OK
    Log("no argument\n");  // OK
    return 0;
}
```

输出结果为：  
```
tow argument: hello world! 2023
no argument
```

## 总结
> + __VA_ARGS__的作用是在宏中将可变参数的内容替换掉__VA_ARGS__的内容
> + ##__VA_ARGS__可以使__VA_ARGS__为空时，去掉前面的逗号


# Reference
[1] [##__VA_ARGS__与##args的用法](https://blog.csdn.net/lihuan680680/article/details/127843881)  